require=function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({"audio-context":[function(require,module,exports){var window=require("global/window"),Context=window.AudioContext||window.webkitAudioContext;Context&&(module.exports=new Context)},{"global/window":1}],1:[function(require,module,exports){(function(global){"undefined"!=typeof window?module.exports=window:"undefined"!=typeof global?module.exports=global:module.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;len>i;i++)args[i-1]=arguments[i];for(listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned){var m;m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){var ret;return ret=emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],3:[function(require,module,exports){function parse(html,doc){if("string"!=typeof html)throw new TypeError("String expected");doc||(doc=document);var m=/<([\w:]+)/.exec(html);if(!m)return doc.createTextNode(html);html=html.replace(/^\s+|\s+$/g,"");var tag=m[1];if("body"==tag){var el=doc.createElement("html");return el.innerHTML=html,el.removeChild(el.lastChild)}var wrap=map[tag]||map._default,depth=wrap[0],prefix=wrap[1],suffix=wrap[2],el=doc.createElement("div");for(el.innerHTML=prefix+html+suffix;depth--;)el=el.lastChild;if(el.firstChild==el.lastChild)return el.removeChild(el.firstChild);for(var fragment=doc.createDocumentFragment();el.firstChild;)fragment.appendChild(el.removeChild(el.firstChild));return fragment}module.exports=parse;var div=document.createElement("div");div.innerHTML='  <link/><table></table><a href="/a">a</a><input type="checkbox"/>';var innerHTMLBug=!div.getElementsByTagName("link").length;div=void 0;var map={legend:[1,"<fieldset>","</fieldset>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:innerHTMLBug?[1,"X<div>","</div>"]:[0,"",""]};map.td=map.th=[3,"<table><tbody><tr>","</tr></tbody></table>"],map.option=map.optgroup=[1,'<select multiple="multiple">',"</select>"],map.thead=map.tbody=map.colgroup=map.caption=map.tfoot=[1,"<table>","</table>"],map.polyline=map.ellipse=map.polygon=map.circle=map.text=map.line=map.path=map.rect=map.g=[1,'<svg xmlns="http://www.w3.org/2000/svg" version="1.1">',"</svg>"]},{}],4:[function(require,module,exports){function delegate(target,evt,fn,selector){return on(target,evt,delegate.wrap(target,evt,fn,selector))}module.exports=delegate;var on=require("./on"),isFn=require("is-function"),isString=require("mutype/is-string"),isArrayLike=require("mutype/is-array-like");delegate.wrap=function(container,evt,fn,selector){if(isFn(selector)){var tmp=selector;selector=fn,fn=tmp}return on.wrap(container,evt,fn,function(e){var srcEl=e.target;if(srcEl!==container)return isArrayLike(selector)||(selector=[selector]),selector.some(function(selector){var delegateTarget;if(isString(selector))delegateTarget=srcEl.closest(selector);else{if(!selector.contains(srcEl))return!1;delegateTarget=selector}return delegateTarget&&container!==delegateTarget&&container.contains(delegateTarget)?(e.delegateTarget=delegateTarget,!0):!1})})}},{"./on":12,"is-function":8,"mutype/is-array-like":22,"mutype/is-string":29}],5:[function(require,module,exports){function emit(target,eventName,data,bubbles){var emitMethod,evt=eventName;isNode(target)||target===win?(isEvent(eventName)?evt=eventName:(evt=doc.createEvent("CustomEvent"),evt.initCustomEvent(eventName,bubbles,!0,data)),emitMethod=target.dispatchEvent):$&&target instanceof $?(evt=$.Event(eventName,data),evt.detail=data,emitMethod=bubbles?targte.trigger:target.triggerHandler):emitMethod=target.dispatchEvent||target.emit||target.trigger||target.fire||target.raise;var args=slice(arguments,2);if(emitMethod&&icicle.freeze(target,"emit"+eventName))return emitMethod.apply(target,[evt].concat(args)),icicle.unfreeze(target,"emit"+eventName),target;for(var evtCallbacks=listeners(target,evt),fireList=slice(evtCallbacks),i=0;i<fireList.length;i++)fireList[i]&&fireList[i].apply(target,args);return target}var icicle=require("icicle"),slice=require("sliced"),isString=require("mutype/is-string"),isNode=require("mutype/is-node"),isEvent=require("mutype/is-event"),listeners=require("./listeners");module.exports=function(target,evt){if(target){var args=arguments;return isString(evt)?(args=slice(arguments,2),void evt.split(/\s+/).forEach(function(evt){evt=evt.split(".")[0],emit.apply(this,[target,evt].concat(args))})):emit.apply(this,args)}};var $="undefined"==typeof jQuery?void 0:jQuery,doc="undefined"==typeof document?void 0:document,win="undefined"==typeof window?void 0:window},{"./listeners":6,icicle:7,"mutype/is-event":24,"mutype/is-node":26,"mutype/is-string":29,sliced:9}],6:[function(require,module,exports){function listeners(target,evt,tags){var result,cbs=target[cbPropName];if(!evt){if(result=cbs||{},tags){var filteredResult={};for(var evt in result)filteredResult[evt]=result[evt].filter(function(cb){return hasTags(cb,tags)});result=filteredResult}return result}return cbs&&cbs[evt]?(result=cbs[evt],tags&&tags.length&&(result=result.filter(function(cb){return hasTags(cb,tags)})),result):[]}function hasTags(cb,tags){if(cb._ns)for(var i=tags.length;i--;)if(cb._ns.indexOf(tags[i])>=0)return!0}var cbPropName="_callbacks";listeners.remove=function(target,evt,cb,tags){var evtCallbacks=target[cbPropName];if(!evtCallbacks||!evtCallbacks[evt])return!1;var callbacks=evtCallbacks[evt];if(tags&&tags.length&&!hasTags(cb,tags))return!1;for(var i=0;i<callbacks.length;i++)if(callbacks[i]===cb||callbacks[i].fn===cb){callbacks.splice(i,1);break}},listeners.add=function(target,evt,cb,tags){if(cb){var targetCallbacks=target[cbPropName];targetCallbacks||(targetCallbacks={},Object.defineProperty(target,cbPropName,{value:targetCallbacks})),(targetCallbacks[evt]=targetCallbacks[evt]||[]).push(cb),tags&&tags.length&&(cb._ns=tags)}},module.exports=listeners},{}],7:[function(require,module,exports){function lock(target,name){var locks=lockCache.get(target);return locks&&locks[name]?!1:(locks||(locks={},lockCache.set(target,locks)),locks[name]=!0,!0)}function unlock(target,name){var locks=lockCache.get(target);return locks&&locks[name]?(locks[name]=null,!0):!1}function isLocked(target,name){var locks=lockCache.get(target);return locks&&locks[name]}module.exports={freeze:lock,unfreeze:unlock,isFrozen:isLocked};var lockCache=new WeakMap},{}],8:[function(require,module,exports){function isFunction(fn){var string=toString.call(fn);return"[object Function]"===string||"function"==typeof fn&&"[object RegExp]"!==string||"undefined"!=typeof window&&(fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt)}module.exports=isFunction;var toString=Object.prototype.toString},{}],9:[function(require,module,exports){module.exports=exports=require("./lib/sliced")},{"./lib/sliced":10}],10:[function(require,module,exports){module.exports=function(args,slice,sliceEnd){var ret=[],len=args.length;if(0===len)return ret;var start=0>slice?Math.max(0,slice+len):slice||0;for(void 0!==sliceEnd&&(len=0>sliceEnd?sliceEnd+len:sliceEnd);len-->start;)ret[len-start]=args[len];return ret}},{}],11:[function(require,module,exports){function off(target,evt,fn){if(!target)return target;var callbacks;if(void 0===fn){var args=slice(arguments,1),allOff=target.removeAll||target.removeAllListeners;if(allOff&&allOff.apply(target,args),evt)evt=""+evt,evt.split(/\s+/).forEach(function(evt){var evtParts=evt.split(".");if(evt=evtParts.shift(),callbacks=listeners(target,evt,evtParts),evt){var obj={};obj[evt]=callbacks,callbacks=obj}for(var evtName in callbacks)slice(callbacks[evtName]).forEach(function(cb){off(target,evtName,cb)})});else{callbacks=listeners(target);for(evt in callbacks)off(target,evt)}return target}var offMethod=target.removeEventListener||target.removeListener||target.detachEvent||target.off;return evt.split(/\s+/).forEach(function(evt){var evtParts=evt.split(".");if(evt=evtParts.shift(),offMethod){if(!icicle.freeze(target,"off"+evt))return target;offMethod.call(target,evt,fn),icicle.unfreeze(target,"off"+evt)}fn.closedCall&&(fn.closedCall=!1),listeners.remove(target,evt,fn,evtParts)}),target}module.exports=off;var icicle=require("icicle"),slice=require("sliced"),listeners=require("./listeners");require("mutype/is-array")},{"./listeners":6,icicle:7,"mutype/is-array":23,sliced:9}],12:[function(require,module,exports){function on(target,evt,fn){if(!target)return target;if(isObject(evt)){for(var evtName in evt)on(target,evtName,evt[evtName]);return target}var onMethod=target.addEventListener||target.addListener||target.attachEvent||target.on,cb=fn;return evt=""+evt,evt.split(/\s+/).forEach(function(evt){var evtParts=evt.split(".");if(evt=evtParts.shift(),onMethod){if(!icicle.freeze(target,"on"+evt))return target;onMethod.call(target,evt,cb),icicle.unfreeze(target,"on"+evt)}listeners.add(target,evt,cb,evtParts)}),target}var icicle=require("icicle"),listeners=require("./listeners"),isObject=require("mutype/is-object");module.exports=on,on.wrap=function(target,evt,fn,condition){var cb=function(){return condition.apply(target,arguments)?fn.apply(target,arguments):void 0};return cb.fn=fn,cb}},{"./listeners":6,icicle:7,"mutype/is-object":28}],13:[function(require,module,exports){function getClientY(e,idx){return e.touches?arguments.length>1?findTouch(e.touches,idx).clientY:e.targetTouches[0].clientY:e.clientY}function getClientX(e,idx){return e.touches?arguments.length>idx?findTouch(e.touches,idx).clientX:e.targetTouches[0].clientX:e.clientX}function getClientXY(e,idx){return[getClientX.apply(this,arguments),getClientY.apply(this,arguments)]}function findTouch(touchList,idx){for(var i=0;i<touchList.length;i++)if(touchList[i].identifier===idx)return touchList[i]}getClientXY.x=getClientX,getClientXY.y=getClientY,getClientXY.findTouch=findTouch,module.exports=getClientXY},{}],14:[function(require,module,exports){var counter=Date.now()%1e9;module.exports=function(){return(1e9*Math.random()>>>0)+counter++}},{}],15:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],16:[function(require,module,exports){function prefixize(name){var uName=name[0].toUpperCase()+name.slice(1);return void 0!==fakeStyle[name]?name:void 0!==fakeStyle[prefix+uName]?prefix+uName:""}var fakeStyle=require("./fake-element").style,prefix=require("./prefix").lowercase;module.exports=function(el,obj){if(el&&obj){var name,value;if("string"==typeof obj){if(name=obj,arguments.length<3)return el.style[prefixize(name)];value=arguments[2]||"",obj={},obj[name]=value}for(name in obj)"number"==typeof obj[name]&&/left|right|bottom|top|width|height/i.test(name)&&(obj[name]+="px"),value=obj[name]||"",el.style[prefixize(name)]=value}}},{"./fake-element":17,"./prefix":18}],17:[function(require,module,exports){module.exports=document.createElement("div")},{}],18:[function(require,module,exports){var styles=getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1];dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1],module.exports={dom:dom,lowercase:pre,css:"-"+pre+"-",js:pre[0].toUpperCase()+pre.substr(1)}},{}],19:[function(require,module,exports){function pd(e){e.preventDefault()}var css=require("./css");exports.disable=function(el){css(el,{"user-select":"none","user-drag":"none","touch-callout":"none"}),el.setAttribute("unselectable","on"),el.addEventListener("selectstart",pd)},exports.enable=function(el){css(el,{"user-select":null,"user-drag":null,"touch-callout":null}),el.removeAttribute("unselectable"),el.removeEventListener("selectstart",pd)}},{"./css":16}],20:[function(require,module,exports){module.exports=require("./wrap")(function(a,left,right){return right>=a&&a>=left?!0:!1})},{"./wrap":21}],21:[function(require,module,exports){module.exports=function(fn){return function(a){var args=arguments;if(a instanceof Array){for(var slice,result=new Array(a.length),i=0;i<a.length;i++){slice=[];for(var val,j=0,l=args.length;l>j;j++)val=args[j]instanceof Array?args[j][i]:args[j],val=val,slice.push(val);result[i]=fn.apply(this,slice)}return result}if("object"==typeof a){var slice,result={};for(var i in a){slice=[];for(var val,j=0,l=args.length;l>j;j++)val="object"==typeof args[j]?args[j][i]:args[j],val=val,slice.push(val);result[i]=fn.apply(this,slice)}return result}return fn.apply(this,args)}}},{}],22:[function(require,module,exports){var isString=require("./is-string"),isArray=require("./is-array"),isFn=require("./is-fn");module.exports=function(a){return isArray(a)||a&&!isString(a)&&!a.nodeType&&("undefined"!=typeof window?a!=window:!0)&&!isFn(a)&&"number"==typeof a.length}},{"./is-array":23,"./is-fn":25,"./is-string":29}],23:[function(require,module,exports){module.exports=function(a){return a instanceof Array}},{}],24:[function(require,module,exports){module.exports=function(target){return"undefined"!=typeof Event&&target instanceof Event}},{}],25:[function(require,module,exports){module.exports=function(a){return!(!a||!a.apply)}},{}],26:[function(require,module,exports){module.exports=function(target){return"undefined"!=typeof document&&target instanceof Node}},{}],27:[function(require,module,exports){module.exports=function(a){return"number"==typeof a||a instanceof Number}},{}],28:[function(require,module,exports){module.exports=function(o){return!!o&&"object"==typeof o&&o.constructor===Object}},{}],29:[function(require,module,exports){module.exports=function(a){return"string"==typeof a||a instanceof String}},{}],30:[function(require,module,exports){module.exports=require("./wrap")(function(value,left,right){if(void 0===right&&(right=left,left=0),left>right){var tmp=right;right=left,left=tmp}var frame=right-left;return value=(value+left)%frame-left,left>value&&(value+=frame),value>right&&(value-=frame),value})},{"./wrap":31}],31:[function(require,module,exports){arguments[4][21][0].apply(exports,arguments)},{dup:21}],32:[function(require,module,exports){arguments[4][9][0].apply(exports,arguments)},{"./lib/sliced":33,dup:9}],33:[function(require,module,exports){arguments[4][10][0].apply(exports,arguments)},{dup:10}],34:[function(require,module,exports){function extend(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)source.hasOwnProperty(key)&&(target[key]=source[key])}return target}module.exports=extend},{}],"piano-keyboard":[function(require,module,exports){function Keyboard(options){var self=this;return self instanceof Keyboard?(extend(self,options),self.element||(self.element=document.createElement("div")),selection.disable(self.element),self.element.classList.add("piano-keyboard"),self.element.classList.add("piano-keyboard-"+self.orientation),self.context||(self.context=require("audio-context")),self.id=getUid(),self.createKeys(),self.activeKeys=[],void self.enable()):new Keyboard(element,context,options)}var Emitter=require("events"),inherit=require("inherits"),extend=require("xtend/mutable"),key=require("piano-key"),doc=document,domify=require("domify"),on=require("emmy/on"),emit=require("emmy/emit"),delegate=require("emmy/delegate"),off=require("emmy/off"),getUid=require("get-uid"),isString=require("mutype/is-string"),isArray=require("mutype/is-array"),isNumber=require("mutype/is-number"),selection=require("mucss/selection"),isBetween=(require("mucss/css"),require("mumath/is-between")),getClientCoords=require("get-client-xy"),findTouch=getClientCoords.findTouch,slice=require("sliced");inherit(Keyboard,Emitter);var proto=Keyboard.prototype;proto.createKeys=function(number,startWith){var self=this;number||(number=self.numberOfKeys),startWith||(startWith=self.firstKey),isString(startWith)&&(startWith=key.getNumber(startWith));for(var srcKeyEl=domify('<div class="piano-keyboard-key" tabindex="1" data-key></div>'),i=0;number>i;i++){var keyEl=srcKeyEl.cloneNode(),keyNumber=startWith+i;keyEl.setAttribute("data-key",keyNumber),keyEl.setAttribute("title",key.getName(keyNumber)),key.isBlack(keyNumber)&&(keyEl.setAttribute("data-key-black",!0),keyEl.classList.add("piano-keyboard-key-black")),self.element.appendChild(keyEl)}return self},proto.numberOfKeys=61,proto.firstKey="C1",proto.detune=0,proto.keyboardEvents=!1,proto.orientation="horizontal",proto.enable=function(){function updateKeys(touches,e){touches=slice(touches);for(var unbindKeys=slice(self.activeKeys),bindKeys=[],blackTouches=[],i=0;i<keys.length;i++)touches.forEach(function(touchId){void 0!==touchId.identifier&&(touchId=touchId.identifier);var clientXY,touch=findTouch(touches,touchId);if(clientXY=touch?[touch.clientX,touch.clientY]:[e.clientX,e.clientY],isBetween(clientXY[0],rects[i].left,rects[i].right)&&isBetween(clientXY[1],rects[i].top,rects[i].bottom)){if(blackTouches.indexOf(touchId)>=0)return;bindKeys.indexOf(keys[i])<0&&(bindKeys.push(keys[i]),keys[i].hasAttribute("data-key-black")&&blackTouches.push(touchId));var unbindIdx=unbindKeys.indexOf(keys[i]);unbindIdx>=0&&unbindKeys.splice(unbindIdx,1)}});unbindKeys.forEach(self.noteOff,self),bindKeys.forEach(self.noteOn,self),self.activeKeys.length||(self.isActive=!1,off(doc,"."+self.id))}var self=this;self.element.removeAttribute("disabled");var keys=slice(self.element.childNodes).sort(function(a,b){return a.hasAttribute("data-key-black")?-1:1}),rects=keys.map(function(el){return el.getBoundingClientRect()});return on(self.element,"mousedown."+self.id+" touchstart."+self.id,function(e){e.preventDefault(),updateKeys(e.touches||0,e),self.isActive||(self.isActive=!0,on(doc,"mousemove."+self.id,function(e){e.preventDefault(),updateKeys(0,e)}),on(doc,"touchmove."+self.id,function(e){e.preventDefault(),updateKeys(e.touches,e)}),on(doc,"mouseup."+self.id+" mouseleave."+self.id,function(e){e.preventDefault(),updateKeys(0,e)}),on(doc,"touchend."+self.id,function(e){e.preventDefault(),updateKeys(e.changedTouches,e),updateKeys(e.touches,e)}))}),on(window,"blur",function(e){self.noteOff()}),self.keyboardEvents&&(delegate(self.element,"keydown","[data-key]",function(e){var keyEl=e.delegateTarget,note=self.parseNote(keyEl);if(void 0!==note){if(32===e.which&&self.noteOn(note),39===e.which){var nextEl=keyEl.nextSibling;if(!nextEl)return;nextEl.focus()}if(37===e.which){var nextEl=keyEl.previousSibling;if(!nextEl)return;nextEl.focus()}}}),delegate(self.element,"keyup","[data-key]",function(e){var keyEl=e.delegateTarget,note=self.parseNote(keyEl);void 0!==note&&32===e.which&&self.noteOff(note)})),self},proto.parseNote=function(note){if(isString(note))return key.getNumber(note);if(isNumber(note))return note;if(note instanceof HTMLElement){if(!note.hasAttribute("data-key"))return;return parseInt(note.getAttribute("data-key"))}},proto.noteOn=function noteOn(note){var self=this;if(isArray(note))return slice(note).forEach(noteOn,self),self;if(note=self.parseNote(note),void 0===note)return self;var keyEl=self.element.querySelector('[data-key="'+note+'"]');return self.activeKeys.indexOf(keyEl)>=0?self:(self.activeKeys.push(keyEl),emit(self,"noteon",{which:note,value:127}),keyEl.classList.add("active"),keyEl.setAttribute("data-key-active",!0),self)},proto.noteOff=function noteOff(note){var keyEl,self=this;if(void 0===note)return slice(self.activeKeys).forEach(noteOff,self),self;if(note=self.parseNote(note),void 0===note)return self;var keyEl=self.element.querySelector('[data-key="'+note+'"]'),keyIdx=self.activeKeys.indexOf(keyEl);return 0>keyIdx?self:(self.activeKeys.splice(keyIdx,1),emit(self,"noteoff",{which:note,value:0}),keyEl.classList.remove("active"),keyEl.removeAttribute("data-key-active"),self)},proto.disable=function(){var self=this;return self.element.setAttribute("disabled",!0),off(self.element,"."+self.id),self},module.exports=Keyboard},{"audio-context":"audio-context",domify:3,"emmy/delegate":4,"emmy/emit":5,"emmy/off":11,"emmy/on":12,events:2,"get-client-xy":13,"get-uid":14,inherits:15,"mucss/css":16,"mucss/selection":19,"mumath/is-between":20,"mutype/is-array":23,"mutype/is-number":27,"mutype/is-string":29,"piano-key":"piano-key",sliced:32,"xtend/mutable":34}],"piano-key":[function(require,module,exports){var loop=require("mumath/loop"),key={};key.getName=function(number){return key.notes[loop(number-4,12)]+Math.round((number+3)/12)},key.getFrequency=function(number){return"string"==typeof number&&(number=key.getNumberFromName(number)),440*Math.pow(2,(number-49)/12)},key.getNumber=function(frequency){return"string"==typeof frequency?key.getNumberFromName(frequency):12*Math.log(frequency/440)/Math.log(2)+49},key.getNumberFromName=function(name){var note=/[a-z#]+/i.exec(name);note=(note.length?note[0]:"A").toUpperCase();var octave=key.getOctave(name),noteIdx=key.notes.indexOf(note);if(0>noteIdx)throw Error("Unknown note "+name);var noteNumber=12*(octave-1)+noteIdx+4;return noteNumber},key.isBlack=function(name){return"number"==typeof name&&(name=key.getName(name)),/#/.test(name)},key.getOctave=function(name){"number"==typeof name&&(name=key.getName(name));var octave=/-?[0-9.]+/.exec(name);return octave.length?parseFloat(octave[0]):0},key.notes="C C# D D# E F F# G G# A A# B".split(" "),module.exports=key},{"mumath/loop":30}]},{},[]);

<!doctype html>

<link rel="stylesheet" type="text/css" href="../index.css"/>

<style>
	.piano-keyboard {

	}
</style>

<div class="keyboard"></div>

<script src="bundle.js"></script>

<script type="text/javascript">
	var context = require('audio-context');
	var Keyboard = require('piano-keyboard');
	var key = require('piano-key');

	var attack=0.05;      // attack speed
    var release=0.05;   // release speed
    var portamento=0.05;  // portamento/glide speed

	//create oscillator
	var oscillator = context.createOscillator();
	oscillator.frequency.setValueAtTime(110, 0);
	envelope = context.createGain();
	oscillator.connect(envelope);
	envelope.connect(context.destination);
	envelope.gain.value = 0.0;  // Mute the sound
	oscillator.start(0);  // Go ahead and start up the oscillator

	//create keyboard
	var kbdEl = document.querySelector('.keyboard');
	var keyboard = new Keyboard({
		element: kbdEl,
		keyboard: true
	});
	keyboard.on('noteon', function (data) {
		oscillator.frequency.cancelScheduledValues(0);
		oscillator.frequency.setTargetAtTime( key.getFrequency(data.which), 0, portamento );
		envelope.gain.cancelScheduledValues(0);
		envelope.gain.setTargetAtTime(1.0, 0, attack);
	});
	keyboard.on('noteoff', function (data) {
		envelope.gain.cancelScheduledValues(0);
		envelope.gain.setTargetAtTime(0.0, 0, release );

		// envelope.gain.cancelScheduledValues(0);
		// envelope.gain.setTargetAtTime(0.0, 0, release );
		// oscillator.frequency.cancelScheduledValues(0);
		// oscillator.frequency.setTargetAtTime( key.getFrequency(data.which), 0, portamento );
	});
</script>